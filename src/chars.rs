//! Character tables

use kana_macros::charinfo;

use crate::{flag, Flags};

// Some common flag combinations:

const KANJI: Flags = flag::JAPANESE.and(flag::WORD).and(flag::KANJI);
const HIRAGANA: Flags = flag::JAPANESE.and(flag::WORD).and(flag::HIRAGANA);
const KATAKANA: Flags = flag::JAPANESE.and(flag::WORD).and(flag::KATAKANA);
const KANA: Flags = flag::JAPANESE.and(flag::WORD).and(flag::KANA);
const JP_SYMBOL: Flags = flag::JAPANESE.and(flag::SYMBOL);
const JP_PUNCTUATION: Flags = flag::JAPANESE.and(flag::PUNCTUATION);

/// Returns a set of the flags mapped for the given character. The flags are a
/// bitwise combination of the constants in the [`Flags`] namespace.
///
/// If the given character is not mapped, returns zero (i.e. [`Flags::NONE`]).
///
/// See the [`Flags`] namespace and individual flags for more details on the
/// mappings and rationale behind the flags.
pub fn get_flags(chr: char) -> Flags {
	let get = charinfo!(

		//--------------------------------------------------------------------//
		// Spaces
		//--------------------------------------------------------------------//

		" \t" => flag::SPACE,

		// space separator Unicode category
		'\u{00A0}' | '\u{1680}' | '\u{2000}' | '\u{2001}' | '\u{2002}' |
		'\u{2003}' | '\u{2004}' | '\u{2005}' | '\u{2006}' | '\u{2007}' |
		'\u{2008}' | '\u{2009}' | '\u{200A}' | '\u{202F}' | '\u{205F}' |
		'\u{3000}' => flag::SPACE,

		// vertical tab and form feed
		"\x0B\x0C" => flag::SPACE | flag::LINEBREAK,

		// line breaks
		"\r\n" | '\u{0085}' | '\u{2028}' | '\u{2029}' => flag::SPACE | flag::LINEBREAK,

		//--------------------------------------------------------------------//
		// ASCII
		//--------------------------------------------------------------------//

		// Letters and digits
		'0'..='9' => flag::ROMAJI | flag::ROMAN | flag::WORD | flag::NUMBER,
		'A'..='Z' => flag::ROMAJI | flag::ROMAN | flag::WORD,
		'a'..='z' => flag::ROMAJI | flag::ROMAN | flag::WORD,

		// Extended vowels:
		"√¢√™√Æ√¥√ª" | "ƒÅƒìƒ´≈ç≈´" => flag::ROMAJI | flag::ROMAN | flag::WORD,
		"√Ç√ä√é√î√õ" | "ƒÄƒíƒ™≈å≈™" => flag::ROMAJI | flag::ROMAN | flag::WORD,

		// This is a punctuation if you want to parse quotes
		'"' => flag::ROMAJI | flag::PUNCTUATION,

		// Apostrophe is used to disambiguate the romaji
		'\'' => flag::ROMAJI | flag::PUNCTUATION | flag::WORD,

		// Hyphen is used for long vowels
		'-' => flag::ROMAJI | flag::PUNCTUATION | flag::WORD,

		// Solidus is used as equivalent to the kana middle-dot
		'/' => flag::ROMAJI | flag::PUNCTUATION | flag::WORD,

		// U+00B7 - Middle Dot (not the Japanese one)
		'¬∑' => flag::ROMAJI | flag::PUNCTUATION | flag::WORD,

		// Punctuation:
		'!' | ',' | '.' | ':' | ';' | '?' => flag::ROMAJI | flag::PUNCTUATION,

		// Parenthesis and brackets:
		'(' | ')' | '[' | ']' | '{' | '}' => flag::ROMAJI | flag::PUNCTUATION,

		// Symbols:
		'#' | '$' | '%' | '&' | '*' | '+' | '<' | '='  => flag::ROMAJI | flag::SYMBOL,
		'>' | '@' | '^' | '_' | '`' | '|' | '~' | '\\' => flag::ROMAJI | flag::SYMBOL,

		// Additional punctuation
		"¬´¬ª" => flag::ROMAJI | flag::PUNCTUATION,

		// Additional symbols
		"¬¢¬£¬•¬¶¬¨¬Ø‚Ç©" => flag::ROMAJI | flag::SYMBOL,

		//--------------------------------------------------------------------//
		// KANJI
		//--------------------------------------------------------------------//

		// For kanji we just use the Unicode ranges
		'\u{3400}'..='\u{4DBF}'   => KANJI, // CJK Unified Ideographs Extension A
		'\u{4E00}'..='\u{9FFF}'   => KANJI, // CJK Unified Ideographs
		'\u{F900}'..='\u{FAFF}'   => KANJI, // CJK Compatibility Ideographs
		'\u{20000}'..='\u{2A6DF}' => KANJI, // CJK Unified Ideographs Extension B
		'\u{2A700}'..='\u{2B73F}' => KANJI, // CJK Unified Ideographs Extension C
		'\u{2B740}'..='\u{2B81F}' => KANJI, // CJK Unified Ideographs Extension D
		'\u{2B820}'..='\u{2CEAF}' => KANJI, // CJK Unified Ideographs Extension E
		'\u{2CEB0}'..='\u{2EBEF}' => KANJI, // CJK Unified Ideographs Extension F

		// Numeric kanji
		"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅÁôæÂçÉ‰∏áÂÑÑÂÖÜ" => flag::NUMBER,

		// We consider this a kanji for all intents and purposes:
		// - U+3005 „ÄÖ Ideographic Iteration Mark
		'„ÄÖ' => KANJI,

		//--------------------------------------------------------------------//
		// HIRAGANA
		//--------------------------------------------------------------------//

		// Hiragana range:
		// - U+3041 „ÅÅ Hiragana Letter Small A, to
		// - U+3096 „Çñ Hiragana Letter Small Ke
		'„ÅÅ'..='„Çñ' => HIRAGANA,

		// Small characters
		"„ÅÅ„ÅÉ„ÅÖ„Åá„Åâ„Å£„ÇÉ„ÇÖ„Çá" => flag::SMALL,
		"„Çé„Çï„Çñ" => flag::SMALL | flag::RARE,

		// Rare characters
		"„Çê„Çë" => flag::RARE,

		// Additional archaic characters
		// - U+309F „Çü Hiragana Digraph Yori
		// - U+1B001 õÄÅ Hiragana Letter Archaic Ye
		'\u{309F}' | '\u{1B001}' => HIRAGANA | flag::RARE,

		// - U+1B150 Hiragana Letter Small Wi
		// - U+1B151 Hiragana Letter Small We
		// - U+1B152 Hiragana Letter Small Wo
		'\u{1B150}' | '\u{1B151}' | '\u{1B152}' => HIRAGANA | flag::RARE | flag::SMALL,

		//--------------------------------------------------------------------//
		// KATAKANA
		//--------------------------------------------------------------------//

		// U+30A0 „Ç† Katakana-Hiragana Double Hyphen
		'\u{30A0}' => JP_SYMBOL,

		// Katakana range:
		// - U+30A1 „Ç° Katakana Letter Small A
		// - U+30FA „É∫ Katakana Letter Vo
		'„Ç°'..='„É∫' => KATAKANA,

		// Small characters
		"„Ç°„Ç£„Ç•„Çß„Ç©„ÉÉ„É£„É•„Éß" => flag::SMALL,
		"„ÉÆ„Éµ„É∂" => flag::SMALL | flag::RARE,

		// Rare characters
		"„É∞„É±„É∏„Éπ„É∫„É∑" => flag::RARE,

		// Additional archaic characters
		// - U+30FF „Éø Katakana Digraph Koto
		// U+1B000 õÄÄ Katakana Letter Archaic E
		"„ÉøõÄÄ" => KATAKANA | flag::RARE,

		// U+1B164 õÖ§ Katakana Letter Small Wi
		// U+1B165 õÖ• Katakana Letter Small We
		// U+1B166 õÖ¶ Katakana Letter Small Wo
		// U+1B167 õÖß Katakana Letter Small N
		'\u{1B164}'..='\u{1B167}' => KATAKANA | flag::RARE | flag::SMALL,

		// U+31F0 „á∞ Katakana Letter Small Ku
		// U+31F1 „á± Katakana Letter Small Si
		// U+31F2 „á≤ Katakana Letter Small Su
		// U+31F3 „á≥ Katakana Letter Small To
		// U+31F4 „á¥ Katakana Letter Small Nu
		// U+31F5 „áµ Katakana Letter Small Ha
		// U+31F6 „á∂ Katakana Letter Small Hi
		// U+31F7 „á∑ Katakana Letter Small Hu
		// U+31F8 „á∏ Katakana Letter Small He
		// U+31F9 „áπ Katakana Letter Small Ho
		// U+31FA „á∫ Katakana Letter Small Mu
		// U+31FB „áª Katakana Letter Small Ra
		// U+31FC „áº Katakana Letter Small Ri
		// U+31FD „áΩ Katakana Letter Small Ru
		// U+31FE „áæ Katakana Letter Small Re
		// U+31FF „áø Katakana Letter Small Ro
		"„á∞„á±„á≤„á≥„á¥„áµ„á∂„á∑„á∏„áπ„á∫„áª„áº„áΩ„áæ„áø" => KATAKANA | flag::SMALL | flag::RARE,

		// Symbol range:
		// - U+32D0 „ãê Circled Katakana A
		// - U+32FE „ãæ Circled Katakana Wo
		// - U+1F202 üàÇ Squared Katakana Sa
		// - U+1F213 üàì Squared Katakana De
		'\u{32D0}'..='\u{32FE}' | '\u{1F202}' | '\u{1F213}' => JP_SYMBOL,

		// Halfwidth katakana range:
		// - U+FF66 ÔΩ¶ Halfwidth Katakana Letter Wo
		// - Skip: U+FF70 ÔΩ∞ Halfwidth Katakana-Hiragana Prolonged Sound Mark
		// - U+FF9D Ôæù Halfwidth Katakana Letter N
		'\u{FF66}'..='\u{FF6F}' | '\u{FF71}'..='\u{FF9D}' => KATAKANA | flag::HALFWIDTH,

		// Halfwidth small range:
		// - U+FF67 ÔΩß Halfwidth Katakana Letter Small A
		// - U+FF6F ÔΩØ Halfwidth Katakana Letter Small Tu
		'\u{FF67}'..='\u{FF6F}' => flag::SMALL,

		//--------------------------------------------------------------------//
		// KANA
		//--------------------------------------------------------------------//

		// U+3099 Combining Katakana-Hiragana Voiced Sound Mark
		// U+309A Combining Katakana-Hiragana Semi-Voiced Sound Mark
		'\u{3099}' | '\u{309A}' => KANA,

		// U+309B „Çõ Katakana-Hiragana Voiced Sound Mark
		// U+309C „Çú Katakana-Hiragana Semi-Voiced Sound Mark
		// U+309D „Çù Hiragana Iteration Mark
		// U+309E „Çû Hiragana Voiced Iteration Mark
		'\u{309B}' | '\u{309C}' | '\u{309D}' | '\u{309E}' => KANA | flag::PUNCTUATION | flag::RARE,

		// U+30FC „Éº Katakana-Hiragana Prolonged Sound Mark
		'\u{30FC}' => KANA | flag::PUNCTUATION,

		// U+30FB „Éª Katakana Middle Dot
		// U+30FC „Éº Katakana-Hiragana Prolonged Sound Mark
		'\u{30FB}' | '\u{30FC}' => KANA | flag::PUNCTUATION,

		// U+30FD „ÉΩ Katakana Iteration Mark
		// U+30FE „Éæ Katakana Voiced Iteration Mark
		'\u{30FD}' | '\u{30FE}' => KANA | flag::PUNCTUATION | flag::RARE,

		// U+FF65 ÔΩ• Halfwidth Katakana Middle Dot
		// U+FF70 ÔΩ∞ Halfwidth Katakana-Hiragana Prolonged Sound Mark
		'\u{FF65}' | '\u{FF70}' => KANA | flag::PUNCTUATION | flag::HALFWIDTH,

		// U+FF9E Ôæû Halfwidth Katakana Voiced Sound Mark
		// U+FF9F Ôæü Halfwidth Katakana Semi-Voiced Sound Mark
		'\u{FF9E}' | '\u{FF9F}' => KANA | flag::PUNCTUATION | flag::HALFWIDTH | flag::RARE,

		// U+303C „Äº Masu Mark
		'„Äº' => KANA | flag::RARE,

		//--------------------------------------------------------------------//
		// FULLWIDTH
		//--------------------------------------------------------------------//

		"ÔºÅÔºÇÔºàÔºâÔºåÔºéÔºöÔºõÔºüÔºªÔºΩÔΩõÔΩùÔΩüÔΩ†" => flag::FULLWIDTH | JP_PUNCTUATION,

		"ÔºÉÔºÑÔºÖÔºÜÔºáÔºäÔºãÔºçÔºèÔºúÔºùÔºûÔº†ÔººÔºæÔºøÔΩÄÔΩúÔΩûÔø†Ôø°Ôø¢Ôø£Ôø§Ôø•Ôø¶" => flag::FULLWIDTH | JP_SYMBOL,

		'Ôº°'..='Ôº∫' | 'ÔΩÅ'..='ÔΩö' => flag::FULLWIDTH | flag::JAPANESE | flag::ROMAN | flag::WORD,

		'Ôºê'..='Ôºô' => flag::FULLWIDTH | flag::JAPANESE | flag::ROMAN | flag::NUMBER | flag::WORD,

		//--------------------------------------------------------------------//
		// JAPANESE PUNCTUATION
		//--------------------------------------------------------------------//

		// Halfwidth:
		// - U+FF61 ÔΩ° Halfwidth Ideographic Full Stop
		// - U+FF62 ÔΩ¢ Halfwidth Left Corner Bracket
		// - U+FF63 ÔΩ£ Halfwidth Right Corner Bracket
		// - U+FF64 ÔΩ§ Halfwidth Ideographic Comma
		"ÔΩ°ÔΩ¢ÔΩ£ÔΩ§" => flag::HALFWIDTH | JP_PUNCTUATION,

		// U+3001	„ÄÅ	Ideographic Comma
		// U+3002	„ÄÇ	Ideographic Full Stop
		// U+3008	„Äà	Left Angle Bracket
		// U+3009	„Äâ	Right Angle Bracket
		// U+300A	„Ää	Left Double Angle Bracket
		// U+300B	„Äã	Right Double Angle Bracket
		// U+300C	„Äå	Left Corner Bracket
		// U+300D	„Äç	Right Corner Bracket
		// U+300E	„Äé	Left White Corner Bracket
		// U+300F	„Äè	Right White Corner Bracket
		// U+3010	„Äê	Left Black Lenticular Bracket
		// U+3011	„Äë	Right Black Lenticular Bracket
		// U+3014	„Äî	Left Tortoise Shell Bracket
		// U+3015	„Äï	Right Tortoise Shell Bracket
		// U+3016	„Äñ	Left White Lenticular Bracket
		// U+3017	„Äó	Right White Lenticular Bracket
		// U+3018	„Äò	Left White Tortoise Shell Bracket
		// U+3019	„Äô	Right White Tortoise Shell Bracket
		// U+301A	„Äö	Left White Square Bracket
		// U+301B	„Äõ	Right White Square Bracket
		// U+301D	„Äù	Reversed Double Prime Quotation Mark
		// U+301E	„Äû	Double Prime Quotation Mark
		// U+301F	„Äü	Low Double Prime Quotation Mark
		"„ÄÅ„ÄÇ„Äà„Äâ„Ää„Äã„Äå„Äç„Äé„Äè„Äê„Äë„Äî„Äï„Äñ„Äó„Äò„Äô„Äö„Äõ„Äù„Äû„Äü" => JP_PUNCTUATION,

		//--------------------------------------------------------------------//
		// JAPANESE SYMBOLS
		//--------------------------------------------------------------------//

		// Halfwidth:
		// U+FFE8 Ôø® Halfwidth Forms Light Vertical
		// U+FFE9 Ôø© Halfwidth Leftwards Arrow
		// U+FFEA Ôø™ Halfwidth Upwards Arrow
		// U+FFEB Ôø´ Halfwidth Rightwards Arrow
		// U+FFEC Ôø¨ Halfwidth Downwards Arrow
		// U+FFED Ôø≠ Halfwidth Black Square
		// U+FFEE ÔøÆ Halfwidth White Circle
		"Ôø®Ôø©Ôø™Ôø¨Ôø´Ôø≠ÔøÆ" =>  flag::HALFWIDTH | JP_SYMBOL,

		// CJK Symbols and Punctuation

		// Enclosed CJK Letters and Months
		'\u{3200}'..'\u{321F}' | '\u{3220}'..='\u{32FF}' => JP_SYMBOL,

		// CJK Compatibility
		'\u{3300}'..='\u{33FF}' => JP_SYMBOL,

		// numeric
		"„Äá„à†„à°„à¢„à£„à§„à•„à¶„àß„à®„à©" => flag::NUMBER,
		"„âà„ââ„âä„âã„âå„âç„âé„âè" => flag::NUMBER,
		"„âë„âí„âì„âî„âï„âñ„âó„âò„âô„âö„âõ„âú„âù„âû„âü" => flag::NUMBER,
		"„äÄ„äÅ„äÇ„äÉ„äÑ„äÖ„äÜ„äá„äà„äâ" => flag::NUMBER,
		"„ä±„ä≤„ä≥„ä¥„äµ„ä∂„ä∑„ä∏„äπ„ä∫„äª„äº„äΩ„äæ„äø" => flag::NUMBER,

		// CJK Symbols and Punctuation:

		"„ÄÉ„ÄÑ„ÄÜ„Äá„Äí„Äì„Äú„Ä†„Ä°„Ä¢„Ä£„Ä§„Ä•„Ä¶„Äß„Ä®„Ä©„Ä∞„Ä±„Ä≤„Ä≥„Ä¥„Äµ„Ä∂„Ä∑„Ä∏„Äπ„Ä∫„Äª„ÄΩ„Äæ„Äø" => JP_SYMBOL,

		// U+302E „ÄÆ Hangul Single Dot Tone Mark
		// U+302F „ÄØ Hangul Double Dot Tone Mark
		// U+302A ‚óå„Ä™ Ideographic Level Tone Mark
		// U+302B ‚óå„Ä´ Ideographic Rising Tone Mark
		// U+302C ‚óå„Ä¨ Ideographic Departing Tone Mark
		// U+302D ‚óå„Ä≠ Ideographic Entering Tone Mark
		'\u{302E}' | '\u{302F}' | '\u{302A}'..='\u{302D}' => JP_SYMBOL,

		// Radicals

		// CJK Radicals Supplement
		'\u{2E80}'..'\u{2E9A}' | '\u{2E9B}'..='\u{2EF3}' => JP_SYMBOL | flag::RADICAL,

		// Kangxi Radicals, U+2F00 - U+2FDF
		'\u{2F00}'..='\u{2FD5}' => JP_SYMBOL | flag::RADICAL,

		//--------------------------------------------------------------------//

		// default for any unmatched char
		* => flag::NONE,
	);

	get(chr)
}
